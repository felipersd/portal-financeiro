# 1. Fase de Build (para instalar depend√™ncias)
FROM node:20-alpine AS builder

# Vari√°vel de ambiente (para garantir que o npm funcione em prod)
ENV NODE_ENV production

# Define o diret√≥rio de trabalho
WORKDIR /app

# Copia os arquivos de configura√ß√£o de depend√™ncia
COPY package*.json ./
COPY prisma ./prisma/

# Instala as depend√™ncias de produ√ß√£o
RUN npm install --only=production
RUN npx prisma generate

# 2. Fase Final (Runtime)
# Usa uma imagem menor e mais segura
FROM node:20-alpine AS final

# Define o diret√≥rio de trabalho
WORKDIR /app

# Copia o c√≥digo fonte (apenas o que √© necess√°rio para a produ√ß√£o)
COPY --from=builder /app/node_modules ./node_modules
COPY . .

# Comando para iniciar o servidor de PRODU√á√ÉO
# üö® AJUSTE ESTE COMANDO CONFORME SEU SCRIPT DE INICIALIZA√á√ÉO DE PROD
CMD ["npm", "run", "start"]